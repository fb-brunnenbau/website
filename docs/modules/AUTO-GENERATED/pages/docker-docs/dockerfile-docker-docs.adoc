= Dockerfile

// +-------------------------------------------+
// |                                           |
// |    DO NOT EDIT HERE !!!!!                 |
// |                                           |
// |    File is auto-generated by pipeline.    |
// |    Contents are based on inline docs.     |
// |                                           |
// +-------------------------------------------+

// Source file = /github/workspace/Dockerfile


Build and run the semver application.

== Overview

This Dockerfile is designed to simplify and streamline the build process of the
link:https://www.fb-brunnenbau.de[www.fb-brunnenbau.de] website by integrating and building its various
components. The main purpose of this Dockerfile is to generate the documentation sites and the
landing page of the website using different tools and configurations.

Once all sites are built, the last stage starts a httpd server, making the website accessible over
HTTP.

=== Example

Use the xref:AUTO-GENERATED:bash-docs/build-and-run-sh.adoc[`build-and-run.sh`] script to build
this image and start a container.

== Prerequisites

This image has been developed and tested with Docker version 24.0.2 on top of Ubuntu 22.10.

== Multistage Image

This image is a multistage image, which means that the Dockerfile is structured to use multiple stages
during the build process. The multistage build feature was introduced to Docker to help create more
efficient and smaller Docker images.

=== Stage: `build-antora`

The Dockerfile leverages link:https://antora.org[Antora], a documentation site generator, to build the
documentation sites of the website. Antora allows the documentation to be sourced from different
repositories, making it easier to manage and update documentation across various projects. The
configuration for Antora can be found in the `configs/docs` folder. The contents from all repos
are cloned from GitHub because (a) project files from the local machine filesystem (the docker-host)
are not present inside container and (b) maybe not all relevant repositories are cloned on the local
workstation, making it impossible to mount everything into the container.

// === Stage: `build-hugo`
//
// Apart from the documentation, the Dockerfile also handles the startpage of the website using
// link:https://gohugo.io[Hugo]. Hugo is a flexible and efficient tool for creating static websites. The
// contents, theme and other dependencies for Hugo can be found in the `sites/root` folder.
//
// The stage follows the instructions from https://gohugo.io/installation/linux.

=== Stage: `run`

Once all the sites are built, the last stage of the image initiates an HTTP server using the Docker image
link:https://hub.docker.com/_/httpd[httpd]. This HTTP server makes the entire website accessible over
HTTP. The resulting image from this stage only includes the built files needed for serving the website,
avoiding any unnecessary dependencies or intermediate build artifacts from previous stages. This
approach helps to create a more efficient and smaller Docker image, which is advantageous for
production deployment and distribution and reduces the surface for protential attacks.

To avoid running the image as `rot`, permssions of `/usr/local/apache2/logs` are changed. This
allows access for the `www-data` user and the default http port is changed to `7888`. That way
the image can be used without root permissions because the htpd server is started by the already existing
`www-data` user,
